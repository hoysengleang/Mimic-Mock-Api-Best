services:
  # Backend (FastAPI)
  mimic-api:
    image: ${PYTHON_IMAGE:-python:3.12-slim}
    container_name: mimic_api
    working_dir: /app
    ports:
      - "${API_PORT:-5000}:8080"
    volumes:
      - ./src/Mimic.API:/app
      - ./data:/app/data
    command: sh -c "pip install --no-cache-dir -r requirements.txt && uvicorn app.main:app --host 0.0.0.0 --port 8080 --reload"
    environment:
      - APP_NAME=${APP_NAME:-Mimic Mock API}
      - API_PREFIX=${API_PREFIX:-/api}
      - DATA_DIR=${DATA_DIR:-./data}
      - PYTHONUNBUFFERED=1

  # Frontend (Vue 3 + Yarn)
  mimic-ui:
    image: ${NODE_IMAGE:-node:20-alpine}
    container_name: mimic_ui
    working_dir: /app
    ports:
      - "${UI_PORT:-3000}:5173"
    volumes:
      - ./src/Mimic.UI:/app
    command: sh -c "yarn install && yarn dev --host"
    depends_on:
      - mimic-api